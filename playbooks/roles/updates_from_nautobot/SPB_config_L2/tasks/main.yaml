---
# ============================================================
# Role: SPB_config_L2
# Description: Configure SPB Topology (Control + Data BVLANs + ISIS + Interfaces)
# Triggered by Nautobot Webhook (create/update)
# ============================================================



# --- Initialization of variables from the webhook ---
- name: Prepare SPB Topology variables
  set_fact:
    topology_name: "{{ topology_name | default('SPB_Topology') }}"
    action_type: "{{ action | default('update') }}"
    control_bvlan_id: "{{ control_bvlan_id | default('1000') }}"
    data_bvlans_list: "{{ data_bvlan_ids.split(',') | map('trim') | list }}"
    devices_list: "{{ devices | default([]) }}"
    interfaces_list: "{{ interfaces | default([]) }}"
    iface_type: "{{ iface_type | default('multi-access') }}"
    hello_interval: "{{ hello_interval | default(3) | int }}"
    hello_multiplier: "{{ hello_multiplier | default(3) | int }}"
    metric: "{{ metric | default(10) | int }}"
    priority: "{{ priority | default(1) | int }}"
    admin_state: "{{ admin_state | default(true) | bool }}"
    ansible_network_os: "{{ ansible_network_os | default('ale.aos8.aos8') }}"

# --- Debug at AWX output 
- name: Show received webhook data
  debug:
    msg:
      - "Webhook Action: {{ action_type }}"
      - "Topology: {{ topology_name }}"
      - "Control BVLAN: {{ control_bvlan_id }}"
      - "Data BVLANs: {{ data_bvlans_list }}"
      - "Devices: {{ devices_list }}"
      - "Interfaces: {{ interfaces_list }}"
  tags: debug
